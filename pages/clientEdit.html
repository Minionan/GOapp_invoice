<!-- pages/clientEdit.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Edit Client</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="invoice-container">
        <h1>Client Edit Form</h1>
        <form id="editClientForm">
            <input type="hidden" id="clientId">
            <label for="clientName">Client Name:</label>
            <input type="text" id="clientName" required><br><br>
            <label for="parentName">Payee Name:</label>
            <input type="text" id="parentName" required><br><br>
            <label for="address1">Address 1:</label>
            <input type="text" id="address1" required><br><br>
            <label for="address2">Address 2:</label>
            <input type="text" id="address2" required><br><br>
            <label for="phone">Phone:</label>
            <input type="text" id="phone" required><br><br>
            <label for="email">Email:</label>
            <input type="text" id="email" required><br><br>
            <label for="abbreviation">Abbreviation:</label>
            <input type="text" id="abbreviation" required><br><br>
            <div class="button-group">
                <button type="button" onclick="saveClient()">Save Client</button>
                <button type="button" onclick="deleteClient()">Delete Client</button>
                <button type="button" onclick="window.location.href='/pages/client.html'">Back</button>
                <br><br>
                <fieldset>
                    <legend>How to use:</legend>
                    <label>
                        1. Edit any client details as per your needs.<br>
                        2. Save, Delete and Back buttons are self-explainatory.<br>
                        3. Edits done to the client will set client details used on the Invoice Form.<br>
                        4. Editing client details does not apply to any of the saved invoices.
                    </label>
                </fieldset><br>
            </div>
        </form>
    </div>
    <script>
        // Fetch client details when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('id');

            if (!clientId || isNaN(clientId)) {
                alert('Invalid client ID');
                window.location.href = '/pages/client.html'; // Redirect to client list
                return;
            }

            // Fetch all clients
            fetch('/clients')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch clients');
                    }
                    return response.json();
                })
                .then(clients => {
                    // Find the specific client by ID
                    const client = clients.find(c => c.id === parseInt(clientId));
                    if (!client) {
                        throw new Error('Client not found');
                    }

                    // Populate the form fields
                    document.getElementById('clientId').value = client.id;
                    document.getElementById('clientName').value = client.clientName;
                    document.getElementById('parentName').value = client.parentName;
                    document.getElementById('address1').value = client.address1;
                    document.getElementById('address2').value = client.address2;
                    document.getElementById('phone').value = client.phone;
                    document.getElementById('email').value = client.email;
                    document.getElementById('abbreviation').value = client.abbreviation;
                })
                .catch(error => {
                    console.error('Error fetching client details:', error);
                    alert('Failed to fetch client details');
                    window.location.href = '/pages/client.html'; // Redirect to client list
                });
        });

        function saveClient() {
            const clientId = document.getElementById('clientId').value;
            const clientName = document.getElementById('clientName').value;
            const parentName = document.getElementById('parentName').value;
            const address1 = document.getElementById('address1').value;
            const address2 = document.getElementById('address2').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const abbreviation = document.getElementById('abbreviation').value;

            fetch(`/client-update?id=${clientId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ clientName, parentName, address1, address2, phone, email, abbreviation })
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/pages/client.html';
                } else {
                    throw new Error('Failed to update client');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to update client');
            });
        }

        function deleteClient() {
            const clientId = document.getElementById('clientId').value;
            const confirmDelete = confirm('Are you sure you want to delete this client?');

            if (confirmDelete) {
                fetch(`/client-delete?id=${clientId}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/pages/client.html';
                    } else {
                        throw new Error('Failed to delete client');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to delete client');
                });
            }
        }
    </script>
</body>
</html>
